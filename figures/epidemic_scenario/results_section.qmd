---
title: "Figure 4 results"
format: html
---

Goal: 400 words.

```{r}
library(tidyverse)

results_summary <- readr::read_csv(
  here::here("figures", "epidemic_scenario", "results_summary.csv")
) |>
  mutate(
    coverage = signif(coverage, 2),
    efficacy = signif(efficacy, 2)
  )

no_intervention <- results_summary |>
  filter(coverage == 0 | efficacy == 0) |>
  group_by(archetype, metric) |>
  summarise(
    mean_value = mean(mean_value),
    max_value = max(max_value),
    min_value = min(min_value)
  )

no_intervention_flu <- no_intervention |>
  filter(archetype == "flu")

no_intervention_covid <- no_intervention |>
  filter(archetype == "sars_cov_2")

flu_random_4 <- results_summary |>
  filter(
    archetype == "flu",
    metric == "peak_daily_incidence",
    efficacy == 0.6,
    coverage_type == "Random",
    coverage == 0.4
  )

flu_random_6 <- results_summary |>
  filter(
    archetype == "flu",
    metric == "peak_daily_incidence",
    efficacy == 0.6,
    coverage_type == "Random",
    coverage == 0.6
  )

flu_targeted_2 <- results_summary |>
  filter(
    archetype == "flu",
    metric == "peak_daily_incidence",
    efficacy == 0.6,
    coverage_type == "Targeted",
    coverage == 0.2
  )

flu_targeted_4 <- results_summary |>
  filter(
    archetype == "flu",
    metric == "peak_daily_incidence",
    efficacy == 0.6,
    coverage_type == "Targeted",
    coverage == 0.4
  )

pct_reduction <- function(archetype, metric, coverage_type, efficacy, coverage) {
  baseline <- results_summary[
    results_summary$archetype == archetype &
      results_summary$metric == metric &
      results_summary$coverage_type == coverage_type &
      results_summary$efficacy == efficacy &
      results_summary$coverage == 0,
    "mean_value"
  ][[1]]

  value <- results_summary[
    results_summary$archetype == archetype &
      results_summary$metric == metric &
      results_summary$coverage_type == coverage_type &
      results_summary$efficacy == efficacy &
      results_summary$coverage == coverage,
    "mean_value"
  ][[1]]

  (baseline - value) / baseline
}
```

## Notes

* Increasing coverage and increasing efficacy both contribute to reduced disease burden across all scenarios
* Peak incidence reduction seems to be around linear in coverage for the random strategy
* Targeted approaches achieve higher reductions at lower coverage levels
* Rate of reduction in disease burden seems to be higher for influenza archetype over COVID-19 archetype
* For the influenza archetype, at high efficacy and coverage levels, the targeted and random strategy both achieved full disease suppression
* Want to make some kind of statements about how efficacy and coverage trade-off
* To achieve an X% reduction in a particular metric required...
  * For both influenza and COVID-19 setting
* COVID-19 archetype is harder to control than the influenza archetype
* How to show 0% efficacy / coverage scenario? Quite useful to have a reference point for "no intervention"
* Shall we call the efficacy scenarios "low, medium, and high" in the text? And maybe in the figure caption?
* Are we logging the proportion of transmission which occurs in different locations?

## Figure

**Figure caption**:
Analyses of the impact of air quality interventions on disease burden across two epidemic scenarios.

```{r, echo=FALSE, out.width = '100%'}
knitr::include_graphics("figure4.png")
```

## Writing

Next we evaluated the impact of air quality interventions on disease burden across two archetypal epidemic scenarios approximating influenza and COVID-19.
We varied intervention efficacy and population coverage, and considered both random and targeted deployment strategies.

Without interventions, the influenza archetype produced a peak incidence of `r signif(filter(no_intervention_flu, metric == "peak_daily_incidence")$mean_value, 3)` per 1,000 and a final epidemic size of `r 100 * signif(filter(no_intervention_flu, metric == "epidemic_final_size")$mean_value, 3)`%, whereas the COVID-19 archetype yielded a peak incidence of `r signif(filter(no_intervention_covid, metric == "peak_daily_incidence")$mean_value, 3)` per 1,000 and a final epidemic size of `r 100 * signif(filter(no_intervention_covid, metric == "epidemic_final_size")$mean_value, 3)`%.

Across both archetypes, higher efficacy or wider coverage led to reductions in disease burden across all metrics considered.
The rate of reduction in final epidemic size and peak incidence was higher for the influenza archetype than the COVID-19 archetype.
The influenza archetype responded more strongly to interventions: random deployment at 40% coverage and 60% efficacy reduced the final epidemic size by `r signif(100 * pct_reduction("flu", "epidemic_final_size", "Random", 0.6, 0.4), 3)`%, compared with `r signif(100 * pct_reduction("sars_cov_2", "epidemic_final_size", "Random", 0.6, 0.4), 2)`% for the COVID-19 archetype under the same settings.
Under a range of intervention settings, influenza epidemics were close to fully suppressed: 80% random coverage with 60% efficacy gave a `r signif(100 * pct_reduction("flu", "peak_daily_incidence", "Random", 0.6, 0.8), 3)`% drop in peak incidence.
Achieving similar levels of suppression for COVID-19 required the highest level of intervention.

Efficacy and coverage acted as partially interchangeable levers.
In simulations of influenza, expanding randomly allocated coverage from 40% to 60% at 40% efficacy lowered the final epidemic size by $X$%, matching the $X$% gain from instead increasing efficacy from 40% to 60% while holding coverage at 40%.
The same swap in the COVID-19 archetype delivered only $X$ to $Y$% reductions, highlighting its greater resistance to control.

For the random coverage strategy, disease burden generally declined in near-linear fashion as coverage increased.
Under 60% efficacy in the influenza archetype, peak incidence dropped by `r signif(100 * pct_reduction("flu", "peak_daily_incidence", "Random", 0.6, 0.4), 3)`% at 40% coverage, `r signif(100 * pct_reduction("flu", "peak_daily_incidence", "Random", 0.6, 0.6), 3)`% at 60% coverage, and `r signif(100 * pct_reduction("flu", "peak_daily_incidence", "Random", 0.6, 0.8), 3)`% at 80% coverage.

The targeted deployment strategies achieved higher reductions in disease burden at lower coverage levels than the random strategy.
For the influenza archetype at 60% efficacy, the random strategy required 60% coverage to reach a peak daily incidence of `r signif(flu_random_6$mean_value, 3)` per 1,000, while the targeted strategy achieved the same result with only 40% coverage, producing a peak daily incidence of `r signif(flu_targeted_4$mean_value, 3)` per 1,000.
This pattern also held at lower coverage levels: the random strategy's result at 40% coverage -- a peak daily incidence of `r signif(flu_random_4$mean_value, 3)` per 1,000 -- matched the targeted strategy's outcome at just 20% coverage, where peak daily incidence was `r signif(flu_targeted_2$mean_value, 3)` per 1,000.
In these cases, taking a targeted approach allowed a 20% reduction in coverage required to achieve a given result.

Targeting delivered the largest benefits in the mid-range coverage scenarios, where, for example, 60% efficacy and 20% coverage reduced peak incidence by `r signif(100 * pct_reduction("sars_cov_2", "peak_daily_incidence", "Targeted", 0.6, 0.2), 2)`% for the COVID-19 archetype compared with `r signif(100 * pct_reduction("sars_cov_2", "peak_daily_incidence", "Random", 0.6, 0.2), 2)`% under random deployment.
As coverage approaches 100%, the random and targeted strategies converge.
